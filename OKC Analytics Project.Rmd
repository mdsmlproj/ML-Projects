---
title: 'Analyst Intern, Data Science & Solutions Project'
output: html_document
author: "Govind Pillai"
date: "`r format(Sys.Date(), '%m/%d/%y')`"
---

```{r set options, include=FALSE}
# DO NOT CHANGE THE LINE BELOW 
knitr::opts_chunk$set(echo = TRUE)
```

``` {css styling, echo=FALSE}

<style>
.tocify {
max-width: 175px !important;
}
</style>

<style>
.main-container {
width: 100%;
max-width: 940px;
margin-left: 250px;
margin-right: auto;
}
</style>

<style>
.red-header {
  color: red;
}
</style>

```

```{r logo, echo = FALSE}

htmltools::img(src = 'https://cdn.nba.com/logos/nba/1610612760/primary/L/logo.svg',
                height = '250px',
                alt = 'logo',
                style = 'position: fixed; top: -40px; left: 5px;')
```


# Introduction  

The purpose of this project is to gauge your technical skills and problem solving ability by working through something similar to a real NBA data science project. You will work your way through this R Markdown document, answering questions as you go along. Please begin by adding your name to the "author" key in the YAML header. When you're finished with the document, come back and type your answers into the answer key at the top. Please leave all your work below and have your answers where indicated below as well. Please note that we will be reviewing your code so make it clear, concise and avoid long printouts. Feel free to add in as many new code chunks as you'd like.

Remember that we will be grading the quality of your code and visuals alongside the correctness of your answers. Please try to use the tidyverse as much as possible (instead of base R and explicit loops.)  

**Note:**    

**Throughout this document, any `season` column represents the year each season started. For example, the 2015-16 season will be in the dataset as 2015. For most of the rest of the project, we will refer to a season by just this number (e.g. 2015) instead of the full text (e.g. 2015-16).**   

<h1 class="red-header">Answers</h1>  

## Part 1      

**Question 1:**   

- 1st Team: 25.9 points per game  
- 2nd Team: 23.1 points per game  
- 3rd Team: 20.5 points per game  
- All-Star: 21.6 points per game   

**Question 2:** 4.7 Years  

**Question 3:** 

- Elite: 2 players.  
- All-Star: 1 players.  
- Starter: 11 players.  
- Rotation: 7 players.  
- Roster: 14 players.  
- Out of League: 38 players.  

**Open Ended Modeling Question:** Please show your work and leave all responses below in the document.


## Part 2  

**Question 1:** 28.8%   
**Question 2:** Written question, put answer below in the document.    
**Question 3:** Written question, put answer below in the document.    
  

# Setup and Data    

```{r load data, message = F, warning = F}
library(tidyverse)
library(dplyr)
library(tidymodels)
library(reactable)
library(ggplot2)
# Note, you will likely have to change these paths. If your data is in the same folder as this project, 
# the paths will likely be fixed for you by deleting ../../Data/awards_project/ from each string.
awards <- read_csv("awards_data.csv")
player_data <- read_csv("player_stats.csv")
team_data <- read_csv("team_stats.csv")
rebounding_data <- read_csv("team_rebounding_data_22.csv")
```

## Part 1 -- Awards  

In this section, you're going to work with data relating to player awards and statistics. You'll start with some data manipulation questions and work towards building a model to predict broad levels of career success.  

### Question 1  

**QUESTION:** What is the average number of points per game for players in the 2007-2021 seasons who won All NBA First, Second, and Third teams (**not** the All Defensive Teams), as well as for players who were in the All-Star Game (**not** the rookie all-star game)?

```{r}
specific_awards <-awards %>%
  rename(first = "All NBA First Team",second = "All NBA Second Team", third = "All NBA Third Team") %>%
  mutate(team_type = ifelse(first,"first",ifelse(second,"second",ifelse(third,"third",NA)))) %>%
  dplyr::select(season,nbapersonid,team_type,all_star_game) %>%
  filter(!is.na(team_type) | all_star_game) #selects all players in the award database that has been on an All NBA team, or was an All-star
```

```{r}
player_points <- player_data %>%
  mutate(ppg = points/games) %>%
  dplyr::select(season,nbapersonid,ppg) #produces a table with the points per game by a player in a single NBA season
```

```{r}
all_nba_averages <- inner_join(player_points,specific_awards,by=c("season","nbapersonid")) %>%
  group_by(team_type) %>%
  summarise(mean_points = round(mean(ppg),1)) %>%
  filter(!(is.na(team_type))) #creates the ppg averages for the All-NBA teams

all_nba_averages
```

```{r}
all_star_averages <- inner_join(player_points,specific_awards,by=c("season","nbapersonid")) %>%
  group_by(all_star_game) %>%
  summarise(mean_points = round(mean(ppg),1)) %>%
  filter(!is.na(all_star_game)) #creates the ppg average for the All-stars

all_star_averages
```

<span style="color:red">**ANSWER 1:**</span>  

1st Team: 25.9 points per game  
2nd Team: 23.1 points per game  
3rd Team: 20.5 points per game  
All-Star: 21.6 points per game   


### Question 2  

**QUESTION:** What was the average number of years of experience in the league it takes for players to make their first All NBA Selection (1st, 2nd, or 3rd team)? Please limit your sample to players drafted in 2007 or later who did eventually go on to win at least one All NBA selection. For example:

- Luka Doncic is in the dataset as 2 years. He was drafted in 2018 and won his first All NBA award in 2019 (which was his second season).  
- LeBron James is not in this dataset, as he was drafted prior to 2007.  
- Lu Dort is not in this dataset, as he has not received any All NBA honors.  

```{r}
all_nba_players <- specific_awards %>%
  filter(!(is.na(team_type))) %>%
  dplyr::select(season,nbapersonid) %>%
  group_by(nbapersonid) %>%
  summarise(season = min(season)) #gets the first season in the dataset a player made All-NBA
```

```{r}
player_draft_years <- player_data %>%
  filter(draftyear >= 2007) %>%
  dplyr::select(season,nbapersonid,draftyear) #lists each player in the dataset and their draft year
```

```{r}
avg_experience <- inner_join(player_draft_years,all_nba_players,by=c("season","nbapersonid")) %>%
  mutate(career_season = season-draftyear+1) %>%
  summarise(mean_years = round(mean(career_season),1)) #creates a dataset that includes a column of the number of years between a players draft year and their first year making All-NBA. We can find the average of that column.

avg_experience
```

<span style="color:red">**ANSWER 2:**</span>  

4.7 Years  


## Data Cleaning Interlude  

You're going to work to create a dataset with a "career outcome" for each player, representing the highest level of success that the player achieved for **at least two** seasons *after his first four seasons in the league* (examples to follow below!). To do this, you'll start with single season level outcomes. On a single season level, the outcomes are:  

- Elite: A player is "Elite" in a season if he won any All NBA award (1st, 2nd, or 3rd team), MVP, or DPOY in that season.    
- All-Star: A player is "All-Star" in a season if he was selected to be an All-Star that season.   
- Starter:  A player is a "Starter" in a season if he started in at least 41 games in the season OR if he played at least 2000 minutes in the season.    
- Rotation:  A player is a "Rotation" player in a season if he played at least 1000 minutes in the season.   
- Roster:  A player is a "Roster" player in a season if he played at least 1 minute for an NBA team but did not meet any of the above criteria.     
- Out of the League: A player is "Out of the League" if he is not in the NBA in that season.   

We need to make an adjustment for determining Starter/Rotation qualifications for a few seasons that didn't have 82 games per team. Assume that there were 66 possible games in the 2011 lockout season and 72 possible games in each of the 2019 and 2020 seasons that were shortened due to covid. Specifically, if a player played 900 minutes in 2011, he **would** meet the rotation criteria because his final minutes would be considered to be 900 * (82/66) = 1118. Please use this math for both minutes and games started, so a player who started 38 games in 2019 or 2020 would be considered to have started 38 * (82/72) = 43 games, and thus would qualify for starting 41. Any answers should be calculated assuming you round the multiplied values to the nearest whole number.

Note that on a season level, a player's outcome is the highest level of success he qualifies for in that season. Thus, since Shai Gilgeous-Alexander was both All-NBA 1st team and an All-Star last year, he would be considered to be "Elite" for the 2022 season, but would still qualify for a career outcome of All-Star if in the rest of his career he made one more All-Star game but no more All-NBA teams. Note this is a hypothetical, and Shai has not yet played enough to have a career outcome.   

Examples:  

- A player who enters the league as a rookie and has season outcomes of Roster (1), Rotation (2), Rotation (3), Roster (4), Roster (5), Out of the League (6+) would be considered "Out of the League," because after his first four seasons, he only has a single Roster year, which does not qualify him for any success outcome.  
- A player who enters the league as a rookie and has season outcomes of Roster (1), Rotation (2), Starter (3), Starter (4), Starter (5), Starter (6), All-Star (7), Elite (8), Starter (9) would be considered "All-Star," because he had at least two seasons after his first four at all-star level of production or higher.  
- A player who enters the league as a rookie and has season outcomes of Roster (1), Rotation (2), Starter (3), Starter (4), Starter (5), Starter (6), Rotation (7), Rotation (8), Roster (9) would be considered a "Starter" because he has two seasons after his first four at a starter level of production. 

### Question 3  

**QUESTION:** There are 73 players in the `player_data` dataset who have 2010 listed as their draft year. How many of those players have a **career** outcome in each of the 6 buckets?  

```{r}
player_data_2010 <- player_data %>%
  filter(draftyear == 2010) %>%
  dplyr::select(season,nbapersonid,player,mins,games_start) %>%
  group_by(season,nbapersonid,player) %>%
  summarise(mins = sum(mins),games_start=sum(games_start),.groups = "keep") %>%
  mutate(season_games = ifelse(season == 2011,66,ifelse(season ==2019 | season == 2020,72,82))) %>%
  mutate(mins = round(mins*(82.0/season_games),0)) %>%
  mutate(games_start = round(games_start*(82.0/season_games),0)) #Sums up the stats of any players that played on multiple teams in a single season. Also normalizes the stats for the 2011, 2019, and 2022 seasons. 
```

```{r}
outcome_awards <- awards %>%
  dplyr::select(nbapersonid,season,"All NBA First Team", "All NBA Second Team", "All NBA Third Team", "Most Valuable Player_rk","Defensive Player Of The Year_rk",all_star_game) %>%
  distinct() %>%
  rename(all_first = "All NBA First Team", all_second = "All NBA Second Team", all_third = "All NBA Third Team", mvp = "Most Valuable Player_rk", dpoy = "Defensive Player Of The Year_rk", all_star = all_star_game) #collects All-NBA, MVP, and DPOY stats for every player in the dataset.
```

```{r}
season_outcomes <- right_join(outcome_awards,player_data_2010,by=c("season","nbapersonid")) %>%
  mutate(all_first = coalesce(all_first,0)) %>%
  mutate(all_second = coalesce(all_second,0)) %>%
  mutate(all_third = coalesce(all_third,0)) %>%
  mutate(mvp = ifelse(is.na(mvp) | mvp != 1, 0,1)) %>%
  mutate(dpoy = ifelse(is.na(dpoy) | dpoy != 1,0,1)) %>%
  mutate(all_star = ifelse(is.na(all_star) | !all_star,0,1)) %>%
  mutate(outcome = ifelse(all_first+all_second+all_third+mvp+dpoy > 0,"Elite",
                   ifelse(all_star == 1,"All-Star",
                   ifelse(games_start >= 41 | mins >= 2000, "Starter",
                   ifelse(mins >= 1000,"Rotation","Roster"))))) %>%
  dplyr::select(nbapersonid,season, player,mins, games_start, outcome) %>%
  arrange(nbapersonid,season) #Joins the awards and player statistics datasets together and replaces any NA values with 0 using coalesce. Creates the single season outcomes based upon the specified criteria.
```

```{r}
total_career_outcomes <- season_outcomes %>%
  filter(season > 2013) %>%
  mutate(allstar = ifelse(outcome=="All-Star",1,0)) %>%
  mutate(elite = ifelse(outcome == "Elite",1,0)) %>%
  mutate(starter = ifelse(outcome == "Starter",1,0)) %>%
  mutate(rotation = ifelse(outcome == "Rotation",1,0)) %>%
  mutate(roster = ifelse(outcome == "Roster",1,0)) %>%
  group_by(nbapersonid,player) %>%
  summarise(elite = sum(elite), allstar = sum(allstar), starter = sum(starter), rotation = sum(rotation), roster = sum(roster),.groups="keep") #Creates a tally total of season outcomes for each player in the dataset
```

```{r}
player_career_outcomes <- total_career_outcomes %>%
  mutate(outcome = ifelse(elite > 1,"Elite",
                   ifelse(allstar + elite > 1,"All-Star",
                   ifelse(starter+allstar+elite > 1,"Starter",
                   ifelse(rotation+starter+allstar+elite > 1, "Rotation",
                   ifelse(roster+rotation+starter+allstar+elite > 1, "Roster", "Out of League"))))))

player_career_outcomes #the tally total with their total career outcome
```
```{r}
unique_player_ids <- player_data %>%
  filter(draftyear == 2010) %>%
  dplyr::select(nbapersonid,player) %>%
  distinct()

unique_player_ids
```
```{r}
right_join(player_career_outcomes, unique_player_ids, by = c("nbapersonid","player")) %>%
  mutate(outcome = factor(coalesce(outcome, "Out of League"),levels = c("Out of League", "Roster", "Rotation", "Starter", "All-Star", "Elite")))%>%
  group_by(outcome) %>%
  summarise(count = n()) %>%
  arrange(desc(outcome)) #calculates the total of each outcome for the 2010 draft class
```

<span style="color:red">**ANSWER 3:**</span>    

Elite: 2 players.  
All-Star: 1 players.  
Starter: 11 players.  
Rotation: 7 players.  
Roster: 14 players.  
Out of League: 38 players.  

### Open Ended Modeling Question   

In this question, you will work to build a model to predict a player's career outcome based on information up through the first four years of his career. 

This question is intentionally left fairly open ended, but here are some notes and specifications.  

1. We know modeling questions can take a long time, and that qualified candidates will have different levels of experience with "formal" modeling. Don't be discouraged. It's not our intention to make you spend excessive time here. If you get your model to a good spot but think you could do better by spending a lot more time, you can just write a bit about your ideas for future improvement and leave it there. Further, we're more interested in your thought process and critical thinking than we are in specific modeling techniques. Using smart features is more important than using fancy mathematical machinery, and a successful candidate could use a simple regression approach. 

2. You may use any data provided in this project, but please do not bring in any external sources of data. Note that while most of the data provided goes back to 2007, All NBA and All Rookie team voting is only included back to 2011.  

3. A player needs to complete at least three additional seasons after their first four to be considered as having a distinct career outcome for our dataset. (We are using 3+ instead of 2+ just to give each player a little more time to accumulate high level seasons before we classify his career). Because the dataset in this project ends in 2021, this means that a player would need to have had the chance to play in the '21, '20, and '19 seasons after his first four years, and thus his first four years would have been '18, '17, '16, and '15. **For this reason, limit your training data to players who were drafted in or before the 2015 season.** Karl-Anthony Towns was the #1 pick in that season.  

4. Once you build your model, predict on all players who were drafted in 2018-2021 (They have between 1 and 4 seasons of data available and have not yet started accumulating seasons that inform their career outcome).  

5. You can predict a single career outcome for each player, but it's better if you can predict the probability that each player falls into each outcome bucket.    

6. Include, as part of your answer:  
  - A brief written overview of how your model works, targeted towards a decision maker in the front office without a strong statistical background. 
  - What you view as the strengths and weaknesses of your model.  
  - How you'd address the weaknesses if you had more time and or more data.  
  - A ggplot or ggplotly visualization highlighting some part of your modeling process, the model itself, or your results.  
  - Your predictions for Shai Gilgeous-Alexander, Zion Williamson, James Wiseman, and Josh Giddey.  
  - (Bonus!) An html table (for example, see the package `reactable`) containing all predictions for the players drafted in 2019-2021.  

**CREATING THE MODEL:** 
\
```{r}
modeling_player_data <- player_data %>%
  filter(draftyear <= 2015 & draftyear >= 2007) %>%
  filter(season < draftyear+4) %>%
  group_by(season, nbapersonid, player) %>%
  summarise(games = sum(games),games_start = sum(games_start), mins = sum(mins), fgm = sum(fgm), fga = sum(fga), fgm3 = sum(fgm3), fga3 = sum(fga3), ftm = sum(ftm), fta = sum(fta), tot_reb = sum(tot_reb), ast = sum(ast), steals = sum(steals), blocks = sum(blocks), tov = sum(tov), tot_fouls = sum(tot_fouls), PER = max(PER),BPM = max(BPM), VORP = max(VORP),.groups = "keep") %>% 
  mutate(tot_games = ifelse(season == 2011,66,82)) %>%
  group_by(nbapersonid,player) %>%
  summarise(games = mean(games*(82/tot_games)),games_start = mean(games_start*(82/tot_games)), mins = mean(mins*(82/tot_games)), fgm = mean(fgm*(82/tot_games)), fga = mean(fga*(82/tot_games)), fgm3 = mean(fgm3*(82/tot_games)), fga3 = mean(fga3*(82/tot_games)), ftm = mean(ftm*(82/tot_games)), fta = mean(fta*(82/tot_games)), tot_reb = mean(tot_reb*(82/tot_games)), ast = mean(ast*(82/tot_games)), steals = mean(steals*(82/tot_games)), blocks = mean(blocks*(82/tot_games)), tov = mean(tov*(82/tot_games)), tot_fouls = mean(tot_fouls*(82/tot_games)), PER = mean(PER),BPM = mean(BPM), VORP = mean(VORP),.groups = "keep") %>%
  mutate(across(where(is.numeric), ~ round(., digits = 1))) %>%
  arrange(player) #sums any stats for players that played for multiple teams in the same season and normalizes the stats for the 2011 season. Calculates average stats of each player's first 4 years in the league. This dataset is limited the players drafted between 2007-2015.
  
```

```{r}
clean_players <- player_data %>%
  filter(draftyear <= 2015 & draftyear >= 2007) %>%
  dplyr::select(season,nbapersonid,draftyear,player,mins,games_start) %>%
  group_by(season,nbapersonid,player,draftyear) %>%
  summarise(mins = sum(mins),games_start=sum(games_start),.groups = "keep") %>%
  mutate(season_games = ifelse(season == 2011,66,ifelse(season ==2019 | season == 2020,72,82))) %>%
  mutate(mins = round(mins*(82.0/season_games),0)) %>%
  mutate(games_start = round(games_start*(82.0/season_games),0))
```

```{r}
clean_season_outcomes <- right_join(outcome_awards,clean_players,by=c("season","nbapersonid")) %>%
  mutate(all_first = coalesce(all_first,0)) %>%
  mutate(all_second = coalesce(all_second,0)) %>%
  mutate(all_third = coalesce(all_third,0)) %>%
  mutate(mvp = ifelse(is.na(mvp) | mvp != 1, 0,1)) %>%
  mutate(dpoy = ifelse(is.na(dpoy) | dpoy != 1,0,1)) %>%
  mutate(all_star = ifelse(is.na(all_star) | !all_star,0,1)) %>%
  mutate(outcome = ifelse(all_first+all_second+all_third+mvp+dpoy > 0,"Elite",
                   ifelse(all_star == 1,"All-Star",
                   ifelse(games_start >= 41 | mins >= 2000, "Starter",
                   ifelse(mins >= 1000,"Rotation","Roster"))))) %>%
  dplyr::select(nbapersonid,season,draftyear, player,mins, games_start, outcome) %>%
  arrange(nbapersonid,season)
```

```{r}
clean_total_career_outcomes <- clean_season_outcomes %>%
  filter(season > draftyear+3) %>%
  mutate(allstar = ifelse(outcome=="All-Star",1,0)) %>%
  mutate(elite = ifelse(outcome == "Elite",1,0)) %>%
  mutate(starter = ifelse(outcome == "Starter",1,0)) %>%
  mutate(rotation = ifelse(outcome == "Rotation",1,0)) %>%
  mutate(roster = ifelse(outcome == "Roster",1,0)) %>%
  group_by(nbapersonid,player) %>%
  summarise(elite = sum(elite), allstar = sum(allstar), starter = sum(starter), rotation = sum(rotation), roster = sum(roster),.groups="keep") %>%
  arrange(player)
```

```{r}
clean_player_career_outcomes <- clean_total_career_outcomes %>%
  mutate(total = elite+roster+rotation+starter+allstar) %>%
  mutate(outcome = ifelse(elite > 1 & total > 2,"Elite",
                   ifelse(allstar + elite > 1 & total > 2,"All-star",
                   ifelse(starter+allstar+elite > 1 & total > 2,"Starter",
                   ifelse(rotation+starter+allstar+elite > 1 & total > 2, "Rotation",
                   ifelse(roster+rotation+starter+allstar+elite > 1 & total > 2, "Roster", "Out of League")))))) %>%
  dplyr::select(nbapersonid,player,outcome) %>%
  arrange(player) #The same process is done above to calculate career outcomes for each player in the player dataset.
```

```{r}
final_model_data <- inner_join(modeling_player_data,clean_player_career_outcomes,by = c("nbapersonid","player")) %>%
  mutate(outcome = factor(outcome))

reactable(final_model_data) #Creates a table with a player's career outcome next to their first 4 year averages.
```

```{r}
set.seed(3435)
award_split <- initial_split(final_model_data, strata = outcome, prop = 0.7)
award_train <- training(award_split)
award_test <- testing(award_split) #Creates a train/test split of the modeling data.
```

```{r}
award_recipe <- recipe(outcome ~ games + games_start + mins + fgm + fga + fgm3 + fga3 + ftm + fta + tot_reb + ast + steals + blocks + tov + BPM, data = award_train) %>% 
  step_dummy(all_nominal_predictors()) %>%
  step_normalize(all_predictors()) #Creates a model recipe for the random forest model.
```

```{r}
award_folds <- vfold_cv(final_model_data, v = 10, 
                          strata = outcome) #10 fold CV to avoid overfitting
```

```{r}
rf_class_spec <- rand_forest(mtry = tune(), 
                           trees = tune(), 
                           min_n = tune()) %>%
  set_engine("ranger") %>% 
  set_mode("classification")

rf_class_wf <- workflow() %>% 
  add_recipe(award_recipe) %>% 
  add_model(rf_class_spec) #creates a workflow for our random forest model
```

```{r}
rf_grid <- grid_regular(mtry(range = c(1, 6)), 
                        trees(range = c(200, 600)),
                        min_n(range = c(10, 20))) #The range for the parameters we will fine tune
```

```{r}
load("tune_res.rda") #Tuning the parameters take time so it has been saved to an rda file. 
```

```{r}
best_auc <- select_best(tune_res, "roc_auc")

final_rf <- finalize_model(
  rf_class_spec,
  best_auc
)

final_rf #Finds the model parameters that produces the best AUC value.
```
```{r}
rf_class_spec_b <- rand_forest(mtry = 1, 
                           trees = 200, 
                           min_n = 20) %>%
  set_engine("ranger") %>% 
  set_mode("classification")

rf_class_wf_b <- workflow() %>% 
  add_recipe(award_recipe) %>% 
  add_model(rf_class_spec_b) #Creates the workflow based on our fine-tuned parameters
```

```{r}
rf_fit <- fit(rf_class_wf_b, award_train) #fits the model onto our training data
```
**HOW IT WORKS:**\
\
For this model, I initially decided to use the following statistics as predictors for the outcome: games, games_start, mins, fgm, fga, fgm3, fga3, ftm, fta, tot_reb, ast, steals, blocks, tov, and PER, BPM, and VORP. However, due to my relatively small sample size, I chose to eliminate tot_fouls, PER, and VORP from the list. \
\
Each entry in the dataset I utilized to construct the model includes the player, their career outcome, and their averages of the previously stated statistics during the initial 4 years in the league. I took this as an opportunity to try to predict a player's career outcome as their rookie contract begins to wind down. The dataset comprises 378 observations.\
\
The model I decided to go with is a group of decision trees, also known as a Random Forest model. A decision tree functions as a diagram that guides the decision process by asking yes-or-no questions. When you have traversed to the bottom of the tree, you will have a final decision based on the answers given. A Random Forest model uses a bunch of decision trees with fine-tuned parameters and picks the one that best represents the given data. My Random Forest model is able to take in the 4-year player averages as input and predict their career outcome.\
\
The training I utilized to create the model consisted of 70% of the original dataset. The remaining 30% was set aside for testing.\
\
**MODEL RESULTS:**
```{r}
augment(rf_fit, new_data = award_test) %>%
  roc_auc(outcome, .pred_Elite,".pred_All-star",.pred_Starter,.pred_Rotation,.pred_Roster,".pred_Out of League") #Displays the AUC value of our model working on the testing data
```
```{r}
augment(rf_fit, new_data = award_test) %>%
  conf_mat(truth = outcome, estimate = .pred_class) #A matrix that compares our model's predictions with the true values.
```
```{r}
award_curve <- augment(rf_fit, new_data = award_test) %>%
  roc_curve(outcome, .pred_Elite,".pred_All-star",.pred_Starter,.pred_Rotation,.pred_Roster,".pred_Out of League")

autoplot(award_curve) #Provides the AUC curve for each outcome.
```
\
**Strengths of model:**\
\
- It is a Random Forest model, which often provides higher-quality results compared to basic regressions.\
\
- It employs a tuning grid to finely adjust parameters and generate the best possible model.\
\
- It has the capability to predict career outcomes based solely on a player's performance during their first 4 years of their career. Although we might intend to make predictions for players who haven't completed 4 years yet, the model can still generate predictions using the player's current averages.\
\
**Weaknesses of model (and solutions):**\
\
- Relatively low number of data points. Because my model requires data from the first 4 years and we were advised to use players drafted only in 2015 or prior for our training data, the original dataset is constrained to players drafted between 2007 and 2015. This issue could be resolved with a larger dataset.\
\
- Imbalanced data that led to overfitting. Our model tends to predict outcomes like "Out of League," "Starter," and "Roster" much more frequently, as they are significantly more prevalent compared to the other outcomes in the training data. Given more time, I would have aimed to address this by employing techniques like SMOTE to augment the data, thereby creating a more balanced dataset.\
\
- With more time, I would've created an exploratory data analysis to visualize which predictors are more useful for predicting career outcomes and tailored the model to only use predictors that had a substantial effect on our prediction..\
\

**PREDICTIONS FOR 2018-2021 DRAFTEES:**
\
```{r}
recent_player_data <- player_data %>%
  filter(draftyear > 2017 & draftyear < 2022)%>%
  group_by(season, nbapersonid, player) %>%
  summarise(games = sum(games),games_start = sum(games_start), mins = sum(mins), fgm = sum(fgm), fga = sum(fga), fgm3 = sum(fgm3), fga3 = sum(fga3), ftm = sum(ftm), fta = sum(fta), tot_reb = sum(tot_reb), ast = sum(ast), steals = sum(steals), blocks = sum(blocks), tov = sum(tov), tot_fouls = sum(tot_fouls), PER = max(PER),BPM = max(BPM), VORP = max(VORP), .groups = "keep") %>%
group_by(nbapersonid,player) %>%
  summarise(games = mean(games),games_start = mean(games_start), mins = mean(mins), fgm = mean(fgm), fga = mean(fga), fgm3 = mean(fgm3), fga3 = mean(fga3), ftm = mean(ftm), fta = mean(fta), tot_reb = mean(tot_reb), ast = mean(ast), steals = mean(steals), blocks = mean(blocks), tov = mean(tov), tot_fouls = mean(tot_fouls), PER = mean(PER),BPM = mean(BPM), VORP = mean(VORP), .groups = "keep") %>%
  mutate(across(where(is.numeric), ~ round(., digits = 1))) %>%
  arrange(player) 
```

```{r}
recent_player_predictions <- augment(rf_fit, new_data = recent_player_data) %>%
  dplyr::select(player,.pred_Elite,".pred_All-star",.pred_Starter,.pred_Rotation,.pred_Roster,".pred_Out of League") %>%
  mutate(across(where(is.numeric), ~ round(.*100, digits = 1)))

reactable(recent_player_predictions) #percentage chance for each player's predicted career outcome
```
\
**PREDICTIONS FOR SHAI GILGEOUS-ALEXANDER, ZION WILLIAMSON, JAMES WISEMAN, JOSH GIDDEY:**
\
```{r}
reactable(recent_player_predictions %>%
  filter(player == "Shai Gilgeous-Alexander" | player == "Zion Williamson" | player == "James Wiseman" |
           player == "Josh Giddey"))
```
\
The predictions are:\
James Wiseman: Out of League\
Josh Giddey: Starter\
Shai Gilgeous-Alexander: Starter\
Zion Williamson: Starter\
\
It is important to realize that the model was created on somewhat imbalanced data so it is very unlikely to predict Elite or All-star. I think what is interesting is the 20+ % for both Shai and Zion to be Elite. Our model sees enormous upside in both those players. Wiseman with 46.2% Out of the League is also very surprising. This could be because he did not have much playing time with the Warriors due to injury and their rotation. I think his time with the Pistons will most likely prove my model wrong. Josh Giddey is the newest player among the four and has already notched a starter career outcome. I expect his Elite and All-star percentages to rise as he plays more.

## Part 2 -- Predicting Team Stats  

In this section, we're going to introduce a simple way to predict team offensive rebound percent in the next game and then discuss ways to improve those predictions.  
 
### Question 1   

Using the `rebounding_data` dataset, we'll predict a team's next game's offensive rebounding percent to be their average offensive rebounding percent in all prior games. On a single game level, offensive rebounding percent is the number of offensive rebounds divided by their number offensive rebound "chances" (essentially the team's missed shots). On a multi-game sample, it should be the total number of offensive rebounds divided by the total number of offensive rebound chances.    

Please calculate what OKC's predicted offensive rebound percent is for game 81 in the data. That is, use games 1-80 to predict game 81.  

```{r}
rebounding_data %>%
  filter(team == "OKC" & game_number < 81) %>%
  summarise(pred_reb = round(mean(oreb_pct),3)*100)
  
```

<span style="color:red">**ANSWER 1:**</span>    

28.8% 

### Question 2  

There are a few limitations to the method we used above. For example, if a team has a great offensive rebounder who has played in most games this season but will be out due to an injury for the next game, we might reasonably predict a lower team offensive rebound percent for the next game.  

Please discuss how you would think about changing our original model to better account for missing players. You do not have to write any code or implement any changes, and you can assume you have access to any reasonable data that isn't provided in this project. Try to be clear and concise with your answer.  

<span style="color:red">**ANSWER 2:**</span>  



To account for the missing player, I would obtain the player's number of offensive rebounds and the rebound chances he creates for each game and subtract those from the totals. For example, let's consider OKC vs DEN on October 22nd, 2022.\

```{r}
rebounding_data %>%
  filter(team == "OKC" & gamedate == "2022-10-22")
```
\
If our player notched 4 offensive rebounds and missed 2 shots in that game, we would update offensive rebounds to 11 and offensive rebound chances to 54. Additionally, we should include the stats of our replacement player to account for their contributions. By performing this process for every game from 1 to 80, we can gain an understanding of how the team would perform without their prolific rebounder. This lays the groundwork for a more accurate prediction for game 81. \


### Question 3  

In question 2, you saw and discussed how to deal with one weakness of the model. For this question, please write about 1-3 other potential weaknesses of the simple average model you made in question 1 and discuss how you would deal with each of them. You may either explain a weakness and discuss how you'd fix that weakness, then move onto the next issue, or you can start by explaining multiple weaknesses with the original approach and discuss one overall modeling methodology you'd use that gets around most or all of them. Again, you do not need to write any code or implement any changes, and you can assume you have access to any reasonable data that isn't provided in this project. Try to be clear and concise with your answer.  

<span style="color:red">**ANSWER 3:**</span>    

I believe one major issue is that our current model does not take into account the team's opponent. If the opposing team has a prolific rebounder, our offensive rebounds can decrease. Conversely, if their team is relatively small, we would expect to secure more offensive rebounds in that game. The opponent's overall quality of defense also matters, as it affects the number of actual offensive rebound chances our team receives. Another issue is that we are using games 1-80 to predict stats for game 82. Statistics always fluctuate, and there is a good chance that the statistics the team recorded in the first week of the season may not be pertinent to the team's current situation.\
\
To address these issues, I would develop a linear regression model that incorporates the count of defensive rebounds secured by the opponents in each game. If they experience injuries, we can adjust their statistics as we did in Question 2. We will confine our data to games that occurred in the second half of the season, ensuring that the numbers align more closely with the team's present circumstances. By employing a linear regression model with the updated dataset, we can formulate a more precise prediction for the team's offensive rebound percentage.



